var EnjoyHint=function(a){var b,c=this,d={maxElementSearchAttempt:20,onStart:function(){},onEnd:function(){},onSkip:function(){},onNext:function(){}},e=$.extend(d,a),f=[],g=0;$body=$("body");var h=function(){$(".enjoyhint")&&$(".enjoyhint").remove(),$body.css({overflow:"hidden"}),$(document).on("touchmove",i),$body.enjoyhint({onNextClick:function(){l()},onSkipClick:function(){e.onSkip(),m()}})},i=function(a){a.preventDefault()},j=function(){$(".enjoyhint").remove(),$body.css({overflow:"auto"}),$(document).off("touchmove",i)};c.clear=function(){var a=$(".enjoyhint_next_btn"),b=$(".enjoyhint_skip_btn");a.removeClass(c.nextUserClass),a.text("Next"),b.removeClass(c.skipUserClass),b.text("Skip")};var k=function(){if(!f||!f[g])return $body.enjoyhint("hide"),e.onEnd(),void j();e.onNext();var a=$(".enjoyhint");a.removeClass("enjoyhint-step-"+g),a.removeClass("enjoyhint-step-"+(g+1)),a.addClass("enjoyhint-step-"+(g+1));var d=f[g];d.onBeforeStart&&"function"==typeof d.onBeforeStart&&d.onBeforeStart();var h=d.timeout||0;setTimeout(function(){if(!d.selector)for(var a in d)d.hasOwnProperty(a)&&a.split(" ")[1]&&(d.selector=a.split(" ")[1],d.event=a.split(" ")[0],"next"!=a.split(" ")[0]&&"auto"!=a.split(" ")[0]&&"custom"!=a.split(" ")[0]||(d.event_type=a.split(" ")[0]),d.description=d[a]);setTimeout(function(){c.clear()},250),$(document.body).scrollTo(d.selector,d.scrollAnimationSpeed||250,{offset:-100});var f=function(a,b,c){c&&setTimeout(function(){var e=$(d.selector);e.length?a():f(a,b,c-1)},b)};f(function(){var a=$(d.selector),e=n(d.event);if($body.enjoyhint("show"),$body.enjoyhint("hide_next"),b=a,d.event_selector&&(b=$(d.event_selector)),d.event_type||"key"!=d.event||a.keydown(function(a){a.which==d.keyCode&&(g++,k())}),1==d.showNext&&$body.enjoyhint("show_next"),0==d.showSkip?$body.enjoyhint("hide_skip"):$body.enjoyhint("show_skip"),1==d.showSkip,d.nextButton){var f=$(".enjoyhint_next_btn");f.addClass(d.nextButton.className||""),f.text(d.nextButton.text||"Next"),c.nextUserClass=d.nextButton.className}if(d.skipButton){var h=$(".enjoyhint_skip_btn");h.addClass(d.skipButton.className||""),h.text(d.skipButton.text||"Skip"),c.skipUserClass=d.skipButton.className}if(d.event_type)switch(d.event_type){case"auto":switch(a[d.event](),d.event){case"click":}return g++,void k();case"custom":o(d.event,function(){g++,p(d.event),k()});break;case"next":$body.enjoyhint("show_next")}else b.on(e,function(a){d.keyCode&&a.keyCode!=d.keyCode||(this===$(d.selector)[0]&&g++,$(this).off(e),k())});var i=Math.max(a.outerWidth(),a.outerHeight()),j=d.radius||Math.round(i/2)+5,l=a.offset(),m=a.outerWidth(),q=a.outerHeight(),r=void 0!==d.margin?d.margin:10,s={x:l.left+Math.round(m/2),y:l.top+Math.round(q/2)-$(document).scrollTop()},t={enjoyHintElementSelector:d.selector,center_x:s.x,center_y:s.y,text:d.description,top:d.top,bottom:d.bottom,left:d.left,right:d.right,margin:d.margin,scroll:d.scroll,skipArrow:d.skipArrow};d.shape&&"circle"==d.shape?(t.shape="circle",t.radius=j):(t.radius=0,t.width=m+r,t.height=q+r),$body.enjoyhint("render_label_with_shape",t,c.stop)},d.scrollAnimationSpeed+20||270,e.maxElementSearchAttempt)},h)},l=function(){g++,k()},m=function(){var a=f[g],b=$(a.selector);p(a.event),b.off(n(a.event)),j()},n=function(a,b){return a+(b?"custom":"")+".enjoy_hint"},o=function(a,b){$body.on(n(a,!0),b)},p=function(a){$body.off(n(a,!0))};window.addEventListener("resize",function(){null!=b&&$body.enjoyhint("redo_events_near_rect",b[0].getBoundingClientRect())}),c.stop=function(){m()},c.reRunScript=function(a){g=a,k()},c.runScript=function(){g=0,e.onStart(),k()},c.resumeScript=function(){k()},c.setCurrentStep=function(a){g=a},c.getCurrentStep=function(){return g},c.trigger=function(a){switch(a){case"next":l();break;case"skip":m()}},c.setScript=function(a){a&&(f=a)},c.set=function(a){c.setScript(a)},c.setSteps=function(a){c.setScript(a)},c.run=function(){c.runScript()},c.resume=function(){c.resumeScript()},h()};CanvasRenderingContext2D.prototype.roundRect=function(a,b,c,d,e){return c<2*e&&(e=c/2),d<2*e&&(e=d/2),this.beginPath(),this.moveTo(a+e,b),this.arcTo(a+c,b,a+c,b+d,e),this.arcTo(a+c,b+d,a,b+d,e),this.arcTo(a,b+d,a,b,e),this.arcTo(a,b,a+c,b,e),this.closePath(),this},function(a){var b,c,d,e,f,g,h,i,j,k,l,m=window.innerWidth,n=window.innerHeight,o={init:function(o){return this.each(function(){function p(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)c.setAttribute(d,b[d]);return c}var q={onNextClick:function(){},onSkipClick:function(){},animation_time:800};this.enjoyhint_obj={},b=this.enjoyhint_obj,b.resetComponentStuff=function(){c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=window.innerWidth,n=window.innerHeight};var r=a(this);b.options=jQuery.extend(q,o),b.gcl={chooser:"enjoyhint"},b.cl={enjoy_hint:"enjoyhint",hide:"enjoyhint_hide",disable_events_element:"enjoyhint_disable_events",btn:"enjoyhint_btn",skip_btn:"enjoyhint_skip_btn",close_btn:"enjoyhint_close_btn",next_btn:"enjoyhint_next_btn",main_canvas:"enjoyhint_canvas",main_svg:"enjoyhint_svg",svg_wrapper:"enjoyhint_svg_wrapper",svg_transparent:"enjoyhint_svg_transparent",kinetic_container:"kinetic_container"},b.canvas_size={w:1.4*a(window).width(),h:1.4*a(window).height()};var s="enj_canvas";b.enjoyhint=a("<div>",{class:b.cl.enjoy_hint+" "+b.cl.svg_transparent}).appendTo(r),b.enjoyhint_svg_wrapper=a("<div>",{class:b.cl.svg_wrapper+" "+b.cl.svg_transparent}).appendTo(b.enjoyhint),b.$stage_container=a('<div id="'+b.cl.kinetic_container+'">').appendTo(b.enjoyhint),b.$canvas=a('<canvas id="'+s+'" width="'+b.canvas_size.w+'" height="'+b.canvas_size.h+'" class="'+b.cl.main_canvas+'">').appendTo(b.enjoyhint),b.$svg=a('<svg width="'+b.canvas_size.w+'" height="'+b.canvas_size.h+'" class="'+b.cl.main_canvas+" "+b.cl.main_svg+'">').appendTo(b.enjoyhint_svg_wrapper);var t=a(p("defs")),u=a(p("marker",{id:"arrowMarker",viewBox:"0 0 36 21",refX:"21",refY:"10",markerUnits:"strokeWidth",orient:"auto",markerWidth:"16",markerHeight:"12"})),v=a(p("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:2",d:"M0,0 c30,11 30,9 0,20"}));t.append(u.append(v)).appendTo(b.$svg),b.kinetic_stage=new Kinetic.Stage({container:b.cl.kinetic_container,width:b.canvas_size.w,height:b.canvas_size.h,scaleX:1}),b.layer=new Kinetic.Layer,b.rect=new Kinetic.Rect({fill:"rgba(0,0,0,0.6)",width:b.canvas_size.w,height:b.canvas_size.h});var w=a("<div>",{class:b.cl.disable_events_element}).appendTo(b.enjoyhint),x=w.clone().appendTo(b.enjoyhint),y=w.clone().appendTo(b.enjoyhint),z=w.clone().appendTo(b.enjoyhint),A=function(a){a.stopImmediatePropagation()};a("button").focusout(A),w.click(A),x.click(A),y.click(A),z.click(A),b.$skip_btn=a("<div>",{class:b.cl.skip_btn}).appendTo(b.enjoyhint).html("Skip").click(function(a){b.hide(),b.options.onSkipClick()}),b.$next_btn=a("<div>",{class:b.cl.next_btn}).appendTo(b.enjoyhint).html("Next").click(function(a){b.options.onNextClick()}),b.$close_btn=a("<div>",{class:b.cl.close_btn}).appendTo(b.enjoyhint).html("").click(function(a){b.hide(),b.options.onSkipClick()}),b.$canvas.mousedown(function(b){a("canvas").css({left:"4000px"});var c=document.elementFromPoint(b.clientX,b.clientY);return a("canvas").css({left:"0px"}),a(c).click(),!1});var B=0,C=130;b.shape=new Kinetic.Shape({radius:B,center_x:-C,center_y:-C,width:0,height:0,sceneFunc:function(a){var b=this.getContext("2d")._context,c=(this.pos,b.globalCompositeOperation);b.globalCompositeOperation="destination-out",b.beginPath();var d=this.attrs.center_x-Math.round(this.attrs.width/2),e=this.attrs.center_y-Math.round(this.attrs.height/2);b.roundRect(d,e,this.attrs.width,this.attrs.height,this.attrs.radius),b.fillStyle="red",b.fill(),b.globalCompositeOperation=c}}),b.shape.radius=B,b.layer.add(b.rect),b.layer.add(b.shape),b.kinetic_stage.add(b.layer),a(window).on("resize",function(){if(!a(b.stepData.enjoyHintElementSelector).is(":visible"))return b.stopFunction(),void a(window).off("resize");k=window.innerWidth,l=window.innerHeight;var o=a(b.stepData.enjoyHintElementSelector)[0].getBoundingClientRect();b.shape.attrs.center_x=Math.round(o.left+o.width/2),b.shape.attrs.center_y=Math.round(o.top+o.height/2),b.shape.attrs.width=o.width+11,b.shape.attrs.height=o.height+11;var q=window.innerWidth,r=window.innerHeight,s=q/m,t=r/n;if(b.kinetic_stage.setAttr("width",m*s),b.kinetic_stage.setAttr("height",n*t),null!=b.stepData){if(k=window.innerWidth,l=window.innerHeight,g||(g=b.shape.attrs.center_x,h=b.shape.attrs.center_y),!e){e=[];var u=a("#enjoyhint_arrpw_line").attr("d");e.push(u.substr(1).split(",")[0]),e.push(u.substr(u.indexOf("Q")+1).split(",")[0]),e.push(u.split(" ")[2].split(",")[0]),f=[],f.push(u.split(",")[1].split(" ")[0]),f.push(u.split(",")[2].split(" ")[0]),f.push(u.split(",")[3])}var v=a(".enjoy_hint_label");c||(c=v[0].getBoundingClientRect().left,d=v[0].getBoundingClientRect().top);var w=a(".enjoyhint_skip_btn");i||(i=w[0].getBoundingClientRect().left,j=w[0].getBoundingClientRect().top),v.css("left",window.innerWidth/2-v.outerWidth()/2);var x=v[0].getBoundingClientRect();if(window.innerWidth<640)a("#enjoyhint_arrpw_line").hide(),v.css("top",window.innerHeight/2-v.outerHeight()/2);else{a("#enjoyhint_arrpw_line").show(),v.css("top",d);var y,z,A,B,C=x.left+x.width/2<b.shape.attrs.center_x,D=x.top+x.height/2<b.shape.attrs.center_y;window.innerWidth<1200?(y=Math.round(x.left+(x.width/2+15)*(x.left+x.width/2<b.shape.attrs.center_x?1:-1)),A=Math.round(x.top+x.height*(x.top+x.height/2<b.shape.attrs.center_y?1:-1)),z=Math.round(b.shape.attrs.center_x+(b.shape.attrs.radius+15)*(C?-1:1)),B=Math.round(b.shape.attrs.center_y)):(y=Math.round(x.left+x.width/2+(x.width/2+15)*(C?1:-1)),A=Math.round(x.top+x.height/2),z=Math.round(b.shape.attrs.center_x),B=Math.round(b.shape.attrs.center_y+(b.shape.attrs.height/2+15)*(D?-1:1)));var E=y<z?z:y,F=A<B?A:B;Math.abs(x.left+x.width/2-b.shape.attrs.center_x)<200&&(y=z=x.left+x.width/2,A=x.top,E=y,F=A,console.log("ok")),window.innerWidth<900&&(E=y<z?y:z,F=A<B?B:A);var G=("M%d1,%d2 Q%d3,%d4 %d5,%d6".replace("%d1",y).replace("%d2",A).replace("%d3",E).replace("%d4",F).replace("%d5",z).replace("%d6",B),0),H=0;D?A>=B?(H=B,G=y):(H=A,G=z):A>=B?(H=A,G=z):(H=B,G=y),a("#enjoyhint_arrpw_line").remove();var I="M"+y+","+A+" Q"+G+","+H+" "+z+","+B;b.$svg.append(p("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:3","marker-end":"url(#arrowMarker)",d:I,id:"enjoyhint_arrpw_line"})),b.enjoyhint.removeClass(b.cl.svg_transparent)}b.disableEventsNearRect(o);var J=+i+(b.shape.attrs.center_x-g)/2;w.css("left",J<15?15:J),w.css("top",x.top+x.height+20)}b.rect=new Kinetic.Rect({fill:"rgba(0,0,0,0.6)",width:window.innerWidth,height:window.innerHeight}),b.layer.removeChildren(),b.layer.add(b.rect),b.layer.add(b.shape),b.layer.draw(),b.kinetic_stage.draw()});[b.enjoyhint,w,x,y,z];return b.show=function(){b.enjoyhint.removeClass(b.cl.hide)},b.hide=function(){b.enjoyhint.addClass(b.cl.hide);var a=new Kinetic.Tween({node:b.shape,duration:.002,center_x:-C,center_y:-C});a.play()},b.hide(),b.hideNextBtn=function(){b.$next_btn.addClass(b.cl.hide),b.nextBtn="hide"},b.showNextBtn=function(){b.$next_btn.removeClass(b.cl.hide),b.nextBtn="show"},b.hideSkipBtn=function(){b.$skip_btn.addClass(b.cl.hide)},b.showSkipBtn=function(){b.$skip_btn.removeClass(b.cl.hide)},b.renderCircle=function(a){var c=a.r||0,d=a.x||0,e=a.y||0,f=new Kinetic.Tween({node:b.shape,duration:.2,center_x:d,center_y:e,width:2*c,height:2*c,radius:c});f.play();var g=d-c,h=d+c,i=e-c,j=e+c,k=20;return{x:d,y:e,left:g,right:h,top:i,bottom:j,conn:{left:{x:g-k,y:e},right:{x:h+k,y:e},top:{x:d,y:i-k},bottom:{x:d,y:j+k}}}},b.renderRect=function(a,c){var d=a.r||5,e=a.x||0,f=a.y||0,g=a.w||0,h=a.h||0,i=20,j=new Kinetic.Tween({node:b.shape,duration:c,center_x:e,center_y:f,width:g,height:h,radius:d});j.play();var k=Math.round(g/2),l=Math.round(h/2),m=e-k,n=e+k,o=f-l,p=f+l;return{x:e,y:f,left:m,right:n,top:o,bottom:p,conn:{left:{x:m-i,y:f},right:{x:n+i,y:f},top:{x:e,y:o-i},bottom:{x:e,y:p+i}}}},b.renderLabel=function(c){var d=c.x||0;b.originalElementX=d;var e=c.y||0,f=(c.text||0,b.getLabelElement({x:d,y:e,text:c.text})),g=f.width(),h=f.height(),i=f.offset().left,j=f.offset().left+g,k=f.offset().top-a(document).scrollTop(),l=f.offset().top+h,m=10,n={x:i-m,y:k+Math.round(h/2)},o={x:j+m,y:k+Math.round(h/2)},p={x:i+Math.round(g/2),y:k-m},q={x:i+Math.round(g/2),y:l+m};return f.detach(),setTimeout(function(){a("#enjoyhint_label").remove(),f.appendTo(b.enjoyhint)},b.options.animation_time/2),{label:f,left:i,right:j,top:k,bottom:l,conn:{left:n,right:o,top:p,bottom:q}}},b.renderArrow=function(c){if(window.innerWidth>=640){var d=c.x_from||0,e=c.y_from||0,f=c.x_to||0,g=c.y_to||0,h=c.by_top_side,i=0,j=0;h?e>=g?(j=g,i=d):(j=e,i=f):e>=g?(j=e,i=f):(j=g,i=d)}c.text||"";b.enjoyhint.addClass(b.cl.svg_transparent),setTimeout(function(){a("#enjoyhint_arrpw_line").remove();var c="M"+d+","+e+" Q"+i+","+j+" "+f+","+g;b.$svg.append(p("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:3","marker-end":"url(#arrowMarker)",d:c,id:"enjoyhint_arrpw_line"})),b.enjoyhint.removeClass(b.cl.svg_transparent)},b.options.animation_time/2)},b.getLabelElement=function(c){return a("<div>",{class:"enjoy_hint_label",id:"enjoyhint_label"}).css({top:c.y+"px",left:c.x+"px"}).html(c.text).appendTo(b.enjoyhint)},b.disableEventsNearRect=function(a){w.css({top:"0",left:"0"}).height(a.top+5),x.css({top:a.bottom-5+"px",left:"0"}),y.css({top:"0",left:"0px"}).width(a.left),z.css({top:"0",left:a.right+"px"})},function(a){a.event.special.destroyed={remove:function(a){a.handler&&a.handler()}}}(jQuery),b.renderLabelWithShape=function(c){function d(b){return"MD-DIALOG"===b.tagName?b:"undefined"==typeof b.tagName?null:d(a(b).parent()[0])}function e(a,b,c){H=a,I=b,G=c}function f(a,b,c,d,f){var g=[];g=L?a:O?b:N?c:P?d:f,g&&e(g[0],g[1],g[2])}b.stepData=c;var g=d(a(b.stepData.enjoyHintElementSelector)[0]);null!=g&&a(g).on("dialogClosing",function(){b.stopFunction()}),b.resetComponentStuff();var h=c.shape||"rect",i={},j=0,k=0,l={top:c.top||0,bottom:c.bottom||0,left:c.left||0,right:c.right||0};switch(h){case"circle":j=k=c.radius;var m={top:c.center_y-k+l.top,bottom:c.center_y+k-l.bottom,left:c.center_x-j+l.left,right:c.center_x+j-l.right},n=m.right-m.left,o=m.bottom-m.top;c.radius=Math.round(Math.min(n,o)/2),j=k=Math.round(c.radius/2);var p=Math.round(n/2),q=Math.round(o/2);c.center_x=m.left+p,c.center_y=m.top+q,i=b.renderCircle({x:c.center_x,y:c.center_y,r:c.radius});break;case"rect":j=Math.round(c.width/2),k=Math.round(c.height/2);var m={top:c.center_y-k+l.top,bottom:c.center_y+k-l.bottom,left:c.center_x-j+l.left,right:c.center_x+j-l.right};c.width=m.right-m.left,c.height=m.bottom-m.top,j=Math.round(c.width/2),k=Math.round(c.height/2),c.center_x=m.left+j,c.center_y=m.top+k,i=b.renderRect({x:c.center_x,y:c.center_y,w:c.width,h:c.height,r:c.radius},.2)}var r={w:b.enjoyhint.width(),h:b.enjoyhint.height()},s=b.getLabelElement({x:0,y:0,text:c.text}),t=s.outerWidth(),u=s.outerHeight();s.remove();var v=c.center_y-k,w=r.h-(c.center_y+k),x=(c.center_x-j,r.w-(c.center_x+j),r.w-c.center_x<c.center_x?"left":"right",r.h-c.center_y<c.center_y?"top":"bottom"),y=150,z=40,A=y+u+z,B=k+y,C="top"==x?c.center_y-B-u:c.center_y+B,D=window.innerWidth/2-t/2;v<A&&w<A&&(C=c.center_y+z),window.innerWidth<=640;var E=b.renderLabel({x:D,y:C,text:c.text});b.$next_btn.css({left:D,top:C+u+20});var F=D+b.$next_btn.width()+10;"hide"==b.nextBtn&&(F=D),b.$skip_btn.css({left:F,top:C+u+20}),b.$close_btn.css({right:10,top:10}),b.disableEventsNearRect({top:i.top,bottom:i.bottom,left:i.left,right:i.right});var G=!1,H="left",I="left",J=E.left<=i.x&&E.right>=i.x,K=E.right<i.x,L=(E.left>i.x,E.right<i.left,E.left>i.right,E.bottom<i.top),M=E.top>i.bottom,N=E.bottom>=i.y&&E.top<=i.y,O=E.bottom<=i.y&&!L,P=E.top>=i.y&&!M;if(J)if(L)e("bottom","top","top");else{if(!M)return void a("#enjoyhint_arrpw_line").remove();e("top","bottom","bottom")}else K?f(["right","top","top"],["bottom","left","bottom"],["right","left","top"],["top","left","top"],["right","bottom","bottom"]):f(["left","top","top"],["bottom","right","bottom"],["left","right","top"],["top","right","top"],["left","bottom","bottom"]);var Q=E.conn[H],R=i.conn[I],S="top"==G;c.skipArrow?a("#enjoyhint_arrpw_line").remove():b.renderArrow({x_from:Q.x,y_from:Q.y,x_to:window.innerWidth<640?i.left+(i.left>0):R.x,y_to:window.innerWidth<640?i.conn.left.y:R.y,by_top_side:S})},b.clear=function(){b.ctx.clearRect(0,0,3e3,2e3)},this})},set:function(a){return this.each(function(){this.enjoyhint_obj.setValue(a)}),this},show:function(){return this.each(function(){this.enjoyhint_obj.show()}),this},hide:function(){return this.each(function(){this.enjoyhint_obj.hide()}),this},hide_next:function(){return this.each(function(){this.enjoyhint_obj.hideNextBtn()}),this},show_next:function(){return this.each(function(){this.enjoyhint_obj.showNextBtn()}),this},hide_skip:function(){return this.each(function(){this.enjoyhint_obj.hideSkipBtn()}),this},show_skip:function(){return this.each(function(){this.enjoyhint_obj.showSkipBtn()}),this},render_circle:function(a,b,c){return this.each(function(){this.enjoyhint_obj.renderCircle(a,b,c)}),this},render_label:function(a,b,c){return this.each(function(){this.enjoyhint_obj.renderLabel(a,b,c)}),this},render_label_with_shape:function(a,c){return this.each(function(){b.stopFunction=c,this.enjoyhint_obj.renderLabelWithShape(a)}),this},redo_events_near_rect:function(a){b.disableEventsNearRect({top:a.top,bottom:a.bottom,left:a.left,right:a.right})},clear:function(){return this.each(function(){this.enjoyhint_obj.clear()}),this},close:function(a){return this.each(function(){this.enjoyhint_obj.closePopdown()}),this}};a.fn.enjoyhint=function(b){return o[b]?o[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist on $.numinput"),this):o.init.apply(this,arguments)}}(window.jQuery);